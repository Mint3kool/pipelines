apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: deploy-dview
  namespace: dview-tekton-pipeline
spec:
  params:
  - name: deployment-name
    type: string
  - name: git-url
    type: string
  - name: git-revision
    type: string
  - name: quay-account
    type: string
  - name: quay-repo
    type: string
  - name: quay-revision
    type: string
  - default: quay.io/${params.quay-account}/${params.quay-repo}
    name: quay-img-url
    type: string
  - description: Image to deploy
    name: IMAGE
    type: string
  tasks:
  - name: fetch-from-git
    params:
    - name: url
      value: $(params.git-url)
    - name: revision
      value: $(params.git-revision)
    taskRef:
      kind: Task
      name: git-clone
    workspaces:
    - name: ssh-directory
      workspace: ssh-creds
    - name: output
      workspace: git-source
  workspaces:
  - name: git-source
  - name: ssh-creds
